<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5,h6",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="multilabel_classification_intro.html">Multi-label classification</a>
</li>
<li>
  <a href="exploratory_analysis.html">Exploratory Analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p>     </p>
<div id="exploratory-analysis" class="section level1">
<h1>Exploratory analysis</h1>
<p>The legal text is available in several European languages, but we will experiment with two languages - <strong>English</strong> and <strong>German</strong>.</p>
<div id="dataset" class="section level4">
<h4><span class="header">Dataset</span></h4>
<p>The text content (laws/treaties) for each language is available in a file (acquis.cf). The content and the labels for each document has been stored in the file in the following way:</p>
<ul>
<li>Every <strong>odd</strong> line consists of <em>label-ids</em> and the <em>document-id</em> of a document. The labels and document-id is separted by a <em>#</em>.<br />
</li>
<li>Every <strong>even</strong> line consists of the actual text.</li>
</ul>
<p>An example has been shown below in the diagram. On the 1st line there are two lable-ids - <em>3032, 525</em> and the document-id is <em>31958d1006(01)</em>, and the actual text is on 2nd line.</p>
<center>
<img src="Figs/acquis.png" alt="[Fig1. Data format]" />
</center>
<p>   </p>
</div>
<div id="features-used-for-the-task" class="section level4">
<h4><span class="header">Features used for the task </span></h4>
<p>We will be using two sets of features - term incidence and tf-idf as features, and will try to answer the research question - <span class="emphasize">“How the classifiers’ performance changes with different features- one with term frequency-inverse document frequency(tf-idf), another with term incidence?” </span><br />
Therefore we will have two datasets for each language- one containing term-incidence as features and the other containing tf-idf as features.</p>
</div>
<div id="preprocessing" class="section level4">
<h4><span class="header">Preprocessing </span></h4>
<p>Before we start with analyzing text, we need to preprocess it. Text data contains many characters which do not convey much information, like punctuations, white spaces, stop words, etc. In English, certain words like â€œisâ€, â€œtheâ€ is present in every document and does not help to discriminate two documents. But again, depending on the language and the task at hand, we need to deal with such characters differently.</p>
<p><span class="sub-sub-header"> How much the preprocessing varies across languages for our task? </span><br />
Preprocessing will be almost same for both languages - English and German, except for the following:</p>
<ul>
<li>list of stopwords</li>
<li>lemmatization</li>
</ul>
<p>Since the pre-processing is little different for different languages, we need to execute the following code, to perform the pre-processing for a particular language.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">init &lt;-<span class="st"> </span><span class="cf">function</span>(language) {
  <span class="cf">if</span> (language <span class="op">==</span><span class="st"> &quot;english&quot;</span>) {
  <span class="kw">print</span>(<span class="st">&quot;english chosen&quot;</span>)
    lang &lt;&lt;-<span class="st"> &quot;english&quot;</span>
    fileName &lt;&lt;-<span class="st"> &quot;data/english/acquis.cf&quot;</span>
    tfidfArffFileName &lt;&lt;-<span class="st"> &quot;output/tfidf_EN.arff&quot;</span>
    incArffFileName &lt;&lt;-<span class="st"> &quot;output/inc_EN.arff&quot;</span>
    XMLFileName &lt;&lt;-<span class="st"> &quot;output/EN.xml&quot;</span>
    labelFile &lt;&lt;-<span class="st"> &quot;data/english/desc_en.xml&quot;</span>
  }
  <span class="cf">else</span> <span class="cf">if</span> (language <span class="op">==</span><span class="st"> &quot;german&quot;</span>) {
  <span class="kw">print</span>(<span class="st">&quot;german chosen&quot;</span>)
    lang &lt;&lt;-<span class="st"> &quot;german&quot;</span>
    fileName &lt;&lt;-<span class="st"> &quot;data/german/acquis_german.cf&quot;</span>
    tfidfArffFileName &lt;&lt;-<span class="st"> &quot;output/tfidf_DE.arff&quot;</span>
    incArffFileName &lt;&lt;-<span class="st"> &quot;output/inc_DE.arff&quot;</span>
    tfidfXMLFileName &lt;&lt;-<span class="st"> &quot;output/tfidf_DE.xml&quot;</span>
    XMLFileName &lt;&lt;-<span class="st"> &quot;output/DE.xml&quot;</span>
    labelFile &lt;&lt;-<span class="st"> &quot;data/german/desc_de.xml&quot;</span>
    model_file &lt;&lt;-<span class="st"> &quot;output/german-gsd-ud-2.3-181115.udpipe&quot;</span>
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(model_file))
    {
      model &lt;&lt;-<span class="st"> </span><span class="kw">udpipe_download_model</span>(<span class="dt">language =</span> <span class="st">&quot;german&quot;</span>, <span class="dt">model_dir =</span> <span class="st">&quot;output/&quot;</span>)
    } <span class="cf">else</span> {
      model &lt;&lt;-<span class="st"> </span><span class="kw">udpipe_load_model</span>(model_file)
    }
  }
}</code></pre></div>
<p>To choose the language we need to preprocess, we need to pass “english” for English text and “german” for German text in the method <span class="emphasize">init()</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Choosing english for preprocessing</span>
<span class="kw">init</span>(<span class="st">&quot;english&quot;</span>)</code></pre></div>
<p>We need to preprocess two things - the actual text and the labels.</p>
<p>Preprocessing of actual text primarily involves- removal of language dependant stopwords, html tags, punctuations, roman numerals and lemmatization. The lemmatization for English language could be done using <span class="emphasize">lemmatize_strings</span>, but for German language we had to use <span class="emphasize">udpipe</span> model. Lemmatization using udpipe model needs to be done batches, else we get a weird exception, therefore we need to define the following function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generate_lemma_per_document &lt;-<span class="st"> </span><span class="cf">function</span>(content, doc_id) {
  annotated_data_table &lt;-<span class="st">  </span><span class="kw">udpipe_annotate</span>(model, <span class="dt">x =</span> content, <span class="dt">doc_id =</span> doc_id,  <span class="dt">tagger =</span> <span class="st">&quot;default&quot;</span>, <span class="dt">parser =</span> <span class="st">&quot;none&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.table</span>()
  lemma &lt;-<span class="st"> </span><span class="kw">sapply</span>(annotated_data_table<span class="op">$</span>lemma, paste, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)
  <span class="kw">return</span>(lemma)
}</code></pre></div>
<p>The following method performs the preprocessing for the actual text.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_clean_content &lt;-<span class="st"> </span><span class="cf">function</span>(content) {

<span class="cf">if</span>(lang <span class="op">==</span><span class="st"> &quot;english&quot;</span>){
  stopwords &lt;-
<span class="st">    </span><span class="kw">c</span>(<span class="st">&quot;gt&quot;</span>,<span class="st">&quot;notext&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;lt&quot;</span>,<span class="st">&quot;aka&quot;</span>,<span class="st">&quot;oj&quot;</span>,<span class="st">&quot;n&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;eec&quot;</span>,<span class="st">&quot;article&quot;</span>,<span class="st">&quot;directive&quot;</span>,<span class="st">&quot;shall&quot;</span>,<span class="st">&quot;follow&quot;</span>)  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">append</span>(<span class="kw">stopwords</span>(lang))
  }
  <span class="cf">else</span> <span class="cf">if</span>(lang <span class="op">==</span><span class="st"> &quot;german&quot;</span>){
  stopwords &lt;-
<span class="st">    </span><span class="kw">c</span>(<span class="st">&quot;gt&quot;</span>,<span class="st">&quot;keintext&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;lt&quot;</span>,<span class="st">&quot;aka&quot;</span>,<span class="st">&quot;oj&quot;</span>,<span class="st">&quot;n&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;eec&quot;</span>,<span class="st">&quot;article&quot;</span>,<span class="st">&quot;directive&quot;</span>,<span class="st">&quot;soll&quot;</span>,<span class="st">&quot;folgen&quot;</span>)  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">append</span>(<span class="kw">stopwords</span>(lang))
  }
  clean_content &lt;-<span class="st"> </span>content  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">replace_html</span>(<span class="dt">replacement =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>{
      <span class="kw">gsub</span>(<span class="st">&#39;-&#39;</span>, <span class="st">&#39;&#39;</span>, .)
    } <span class="op">%&gt;%</span>
<span class="st">    </span>{
      <span class="kw">gsub</span>(<span class="st">&#39;[[:punct:] ]+&#39;</span>, <span class="st">&#39; &#39;</span>, .)
    } <span class="op">%&gt;%</span>
<span class="st">    </span>{
      <span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[IVXLCDM]+</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot; &quot;</span>, .)
    } <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">tolower</span>()  
    <span class="cf">if</span>(lang <span class="op">==</span><span class="st"> &quot;english&quot;</span>)
    clean_content &lt;-<span class="st"> </span><span class="kw">lemmatize_strings</span>(clean_content)
    <span class="cf">else</span>{
    clean_content &lt;-<span class="st"> </span><span class="kw">stri_trans_general</span>(clean_content, <span class="st">&quot;Latin-ASCII&quot;</span>)
    lemmata &lt;-<span class="st"> </span><span class="kw">c</span>()
    <span class="cf">for</span>(index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">length</span>(clean_content)){
        lemmata[index] &lt;-<span class="st"> </span><span class="kw">mclapply</span>(clean_content[[index]], <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">generate_lemma_per_document</span>(x, index))
        }
    clean_content &lt;-<span class="st"> </span><span class="kw">sapply</span>( lemmata, paste0, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>)
    }
    
    clean_content &lt;-<span class="st"> </span>clean_content <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">removeNumbers</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">removeWords</span>(<span class="dt">words =</span> stopwords)  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">replace_non_ascii</span>(<span class="dt">replacement =</span> <span class="st">&quot; &quot;</span>)  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">trimws</span>()
  
  clean_content
}</code></pre></div>
<p>Since we have already selected the language using <span class="emphasize">init()</span>. The following code will load and preprocess the text.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">connection &lt;-<span class="st"> </span>fileName  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">file</span>(<span class="dt">open =</span> <span class="st">&quot;r&quot;</span>)
raw_text_char &lt;-<span class="st"> </span>connection <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">readLines</span>(<span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)
<span class="kw">close.connection</span>(connection)

text_content_list &lt;-
raw_text_char[<span class="kw">seq</span> (<span class="dv">2</span>, <span class="kw">length</span>(raw_text_char), <span class="dv">2</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">get_clean_content</span>()</code></pre></div>
<p>We need to preprocess labels, as label names are in different file. The dataset- “acquis.cf” file just contains label-ids. Also the label names contains certain characters like space which is inconvenient to generate MLD datasets. The following code generates clean label name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get clean labels</span>
get_clean_label &lt;-<span class="st"> </span><span class="cf">function</span>(labels) {
  labels &lt;-<span class="st"> </span>labels <span class="op">%&gt;%</span>
<span class="st">  </span>{ <span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s|</span><span class="ch">\\</span><span class="st">.|</span><span class="ch">\\</span><span class="st">[|</span><span class="ch">\\</span><span class="st">]|-|</span><span class="ch">\\</span><span class="st">(|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;_&quot;</span>, .) } <span class="op">%&gt;%</span>
<span class="st">  </span>{ <span class="kw">gsub</span>(<span class="st">&quot;&#39;&quot;</span>, <span class="st">&quot;&quot;</span>, .) } <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">replace_non_ascii</span>(<span class="dt">replacement =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">tolower</span>()  <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">paste</span>(<span class="st">&quot;tag&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
  
  labels
}

<span class="co"># gets label name from label-id using xml</span>
get_label_name_list &lt;-<span class="st"> </span><span class="cf">function</span>(label_id_list) {
  desc_xml &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(labelFile)
  
  xm_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">did =</span> <span class="kw">sapply</span>(desc_xml[<span class="st">&quot;//DESCRIPTEUR_ID&quot;</span>], xmlValue),
  <span class="dt">dname =</span> <span class="kw">sapply</span>(desc_xml[<span class="st">&quot;//LIBELLE&quot;</span>], xmlValue))
  xm_df<span class="op">$</span>dname &lt;-<span class="st"> </span><span class="kw">get_clean_label</span>(xm_df<span class="op">$</span>dname)
  
  label_name_list &lt;-<span class="st"> </span>label_id_list <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(<span class="cf">function</span>(labelsets)
  <span class="kw">strsplit</span>(labelsets, <span class="st">&quot; &quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sapply</span>(<span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(<span class="cf">function</span>(label_id_array)
    <span class="kw">lapply</span>(label_id_array, <span class="cf">function</span>(label_id)
      <span class="kw">get_label_name</span>(label_id, xm_df))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(<span class="cf">function</span>(label)
  <span class="kw">paste</span>(label, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>))
  
label_name_list
}

class_labels_list &lt;-<span class="st"> </span>raw_text_char[<span class="kw">seq</span> (<span class="dv">1</span>, <span class="kw">length</span>(raw_text_char),<span class="dv">2</span>)] <span class="op">%&gt;%</span>
<span class="kw">strsplit</span>(<span class="st">&quot;#&quot;</span>) <span class="op">%&gt;%</span>
<span class="kw">sapply</span>(<span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="kw">trimws</span>() <span class="op">%&gt;%</span>
<span class="kw">get_label_name_list</span>()</code></pre></div>
</div>
<div id="data-exploration" class="section level4">
<h4><span class="header">Data Exploration </span></h4>
<p>We generate a dataframe containing the text and the corresponding label for data exploration. Therefore each row dataframe will have the text and one label among the labelsets for the document.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> </span><span class="kw">character</span>()
label &lt;-<span class="st"> </span><span class="kw">character</span>()    
<span class="cf">for</span>(index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(text_content_list)){
    temp_labelset &lt;-<span class="st"> </span><span class="kw">unlist</span>(class_labels_list[[index]])
    <span class="cf">for</span>(label_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(temp_labelset))
    {
        text &lt;-<span class="st"> </span><span class="kw">append</span>(text, text_content_list[[index]])
        label &lt;-<span class="st"> </span><span class="kw">append</span>(label, temp_labelset[[label_index]])
    }
}

text_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(text,label), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="wordcloud" class="section level5">
<h5><span class="header">- Wordcloud </span></h5>
<p>We start exploration with wordcloud, whichis a simple yet informative way to understand textual data and perform analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#generate tokens and count of each word from text </span>
tokens &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">count</span>( word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()

<span class="kw">wordcloud</span>(<span class="dt">words =</span> tokens<span class="op">$</span>word, <span class="dt">freq =</span> tokens<span class="op">$</span>n, <span class="dt">min.freq =</span> <span class="dv">1</span>, <span class="dt">max.words=</span><span class="dv">50</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>,<span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>),<span class="dt">scale=</span><span class="kw">c</span>(<span class="fl">3.5</span>,<span class="fl">0.25</span>))</code></pre></div>
<center>
<img src="Figs/wordcloud_all.png" />
</center>
<p>The prominent words popping in the wordcloud are all law related terms like - “regulation”, “commission”, which does not give us any helpful insight. Therefore we need to incorporate certain law related stopwords in our preprocessing. We remove those stopwords from our dataframe and generate the wordcloud again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">law_stopwrds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;accordance&quot;</span>,<span class="st">&quot;chairman&quot;</span>,<span class="st">&quot;necessary&quot;</span>,<span class="st">&quot;comply&quot;</span>,<span class="st">&quot;reference&quot;</span>,<span class="st">&quot;commission&quot;</span>,<span class="st">&quot;opinion&quot;</span>,<span class="st">&quot;decision&quot;</span>,<span class="st">&quot;annex&quot;</span>,<span class="st">&quot;refer&quot;</span>,<span class="st">&quot;member&quot;</span>,<span class="st">&quot;european&quot;</span>,<span class="st">&quot;treaty&quot;</span>,<span class="st">&quot;throughout&quot;</span>,<span class="st">&quot;regulation&quot;</span>,<span class="st">&quot;particular&quot;</span>,<span class="st">&quot;thereof&quot;</span>,<span class="st">&quot;community&quot;</span>,<span class="st">&quot;committee&quot;</span>,<span class="st">&quot;measure&quot;</span>,<span class="st">&quot;parliament&quot;</span>,<span class="st">&quot;regard&quot;</span>,<span class="st">&quot;amend&quot;</span>,<span class="st">&quot;procedure&quot;</span>,<span class="st">&quot;administrative&quot;</span>,<span class="st">&quot;procedure&quot;</span>,<span class="st">&quot;publication&quot;</span>,<span class="st">&quot;month&quot;</span>,<span class="st">&quot;date&quot;</span>,<span class="st">&quot;year&quot;</span>,<span class="st">&quot;enter&quot;</span>,<span class="st">&quot;force&quot;</span>,<span class="st">&quot;ensure&quot;</span>,<span class="st">&quot;authority&quot;</span>,<span class="st">&quot;take&quot;</span>,<span class="st">&quot;council&quot;</span>,<span class="st">&quot;act&quot;</span>,<span class="st">&quot;within&quot;</span>,<span class="st">&quot;national&quot;</span>,<span class="st">&quot;law&quot;</span>,<span class="st">&quot;main&quot;</span>,<span class="st">&quot;provision&quot;</span>,<span class="st">&quot;mention&quot;</span>,<span class="st">&quot;approve&quot;</span>,<span class="st">&quot;certain&quot;</span>,<span class="st">&quot;whereas&quot;</span>,<span class="st">&quot;eea&quot;</span>,<span class="st">&quot;also&quot;</span>,<span class="st">&quot;apply&quot;</span>,<span class="st">&quot;may&quot;</span>,<span class="st">&quot;can&quot;</span>,<span class="st">&quot;will&quot;</span>,<span class="st">&quot;require&quot;</span>,<span class="st">&quot;paragraph&quot;</span>,<span class="st">&quot;subparagraph&quot;</span>,<span class="st">&quot;official&quot;</span>,<span class="st">&quot;journal&quot;</span>)

tokens &lt;-<span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>tokens<span class="op">$</span>word <span class="op">%in%</span><span class="st"> </span>law_stopwrds)

<span class="kw">wordcloud</span>(<span class="dt">words =</span> tokens<span class="op">$</span>word, <span class="dt">freq =</span> tokens<span class="op">$</span>n, <span class="dt">min.freq =</span> <span class="dv">1</span>, <span class="dt">max.words=</span><span class="dv">50</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>,<span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>),<span class="dt">scale=</span><span class="kw">c</span>(<span class="fl">3.5</span>,<span class="fl">0.25</span>))</code></pre></div>
<center>
<img src="Figs/wordcloud_filter.png" />
</center>
<p>The wordcloud generated now gives more informative insight. It seems the documents/laws are related to state more than a country. Also appearance of certain terms like “export”, “import”, “aid”,“financial”, “grant”, makes it appear that many documents are related to import-export and financial aids/grants.</p>
</div>
<div id="term-frequency-in-the-documents" class="section level5">
<h5><span class="header">Term frequency in the documents </span></h5>
<p>After getting some insight from the wordcloud we examine it further. It will be interesting to see which terms are common for different category of legal text. To get that, we need to count words for each category.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tokens_by_label &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">count</span>(label, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() 

total_words &lt;-<span class="st"> </span>tokens_by_label <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n))
  
tokens_by_label &lt;-<span class="st"> </span><span class="kw">left_join</span>(tokens_by_label, total_words)</code></pre></div>
<div class="figure">
<img src="Figs/freq_tibble.png" />

</div>
<p>There is one row in this data frame for each word-category combination; n is the number of times that word is used in that legal text category and total is the total words in that category. Letâ€™s look at the distribution of n/total for each document category, the number of times a word appears in a novel divided by the total number of terms (words) in that category. We will consider randomly 5 categories, as it is diffucult to analyse over 7000 categories!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tokens_by_label <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(label <span class="op">==</span><span class="st"> &quot;water_treatment_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;wastewater_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;pollution_control_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;atmospheric_pollution_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;fight_against_unemployment_tag&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(n<span class="op">/</span>total, <span class="dt">fill =</span> label)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="ot">NA</span>, <span class="fl">0.0009</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</code></pre></div>
<div class="figure">
<img src="Figs/tf.png" />

</div>
<p>There are very long tails to the right for these categories. These plots exhibit similar distributions for all the categories chosen- many words that occur rarely and fewer words that occur frequently.</p>
<p>Distributions like those shown in Figure above are very common in any given corpus of natural language -website, books, etc. Since we have the data frame we used to plot term frequency, we can examine Zipfâ€™s law.</p>
<blockquote>
<blockquote>
<p>Zipfâ€™s law states that the frequency that a word appears is inversely proportional to its rank.</p>
</blockquote>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">freq_by_rank &lt;-<span class="st"> </span>tokens_by_label <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="kw">row_number</span>(),
         <span class="st">`</span><span class="dt">term frequency</span><span class="st">`</span> =<span class="st"> </span>n<span class="op">/</span>total)

freq_by_rank <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rank, <span class="st">`</span><span class="dt">term frequency</span><span class="st">`</span>, <span class="dt">color =</span> label)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre></div>
<div class="figure">
<img src="Figs/zipflaw.png" />

</div>
<p>The above plot is in log-log coordinates. We can see that text in all the categories in the corpus are similar to each other, and that the relationship between rank and frequency does have negative slope, implying they follow Zipf Law.</p>
</div>
<div id="top-k-words" class="section level5">
<h5><span class="header">Top k words </span></h5>
<p>Let us see the top 10 words for certain categories of the corpus. To find the most importants words it would make sense to use tf-idf rather than term frequency, as tf-idf finds the important words for the content of each document by decreasing the weight for commonly used words and increasing the weight for words that are not used very much in a collection or corpus of documents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tokens_by_label &lt;-<span class="st"> </span><span class="kw">bind_tf_idf</span>(book_words_eurlex,word, label, n)
tokens_by_label</code></pre></div>
<div class="figure">
<img src="Figs/tfidf_tibble.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tokens_by_label <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(label <span class="op">==</span><span class="st"> &quot;water_treatment_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;wastewater_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;pollution_control_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;atmospheric_pollution_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;fight_against_unemployment_tag&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tf_idf)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">bigram =</span> <span class="kw">factor</span>(word, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(word)))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>ungroup <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, tf_idf, <span class="dt">fill =</span> label)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>()</code></pre></div>
<div class="figure">
<img src="Figs/top10_monogram.png" />

</div>
<p>We can see the word “water” appears in categories/labels - atmospheric_pollution_tag, pollution_control_tag and wastewater_tag, which means a lot of pollution related documents are dealing with water pollution. There are many common terms among documents atmospheric_pollution_tag and pollution_control_tag as expected. The category fight_against_unemployment_tag does not share any common terms with the other categories. Actually it would have been interesting if it would have happened! - which could have implied that unemployment might have resulted from pollution or water related cause.</p>
<p>Sometimes bigrams are more meaningful than single words, and it would be inteersting to see how the top 15 words changes for bigrams.</p>
</div>
<div id="top-k-bigrams" class="section level5">
<h5><span class="header">Top k bigrams </span></h5>
<p>As generating bigrams is an expensive operation, we will consider only those labels/cvategories having words- water or pollution or employment. We generate the tokens in similar way, except we use we used token = “ngrams”&quot; and n=2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> bigram_tokens &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&#39;water|pollution|employment&#39;</span>, label)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(bigram, text, <span class="dt">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">count</span>(label, bigram, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()
  
  total_words &lt;-<span class="st"> </span>bigram_tokens <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n))
         
  bigram_tokens &lt;-<span class="st"> </span><span class="kw">left_join</span>(bigram_tokens, total_words)
  bigram_tokens &lt;-<span class="st"> </span><span class="kw">bind_tf_idf</span>(bigram_tokens,bigram, label, n)
 
  bigram_tokens <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(label <span class="op">==</span><span class="st"> &quot;water_treatment_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;wastewater_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;pollution_control_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;atmospheric_pollution_tag&quot;</span> <span class="op">|</span><span class="st"> </span>label<span class="op">==</span><span class="st">&quot;fight_against_unemployment_tag&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tf_idf)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">bigram =</span> <span class="kw">factor</span>(bigram, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(bigram)))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">    </span>ungroup <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(bigram, tf_idf, <span class="dt">fill =</span> label)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>()</code></pre></div>
<div class="figure">
<img src="Figs/top10_bigram.png" />

</div>
<p>Now we see the categories pollution_control_tag and atmospheric_pollution_tag share most of the terms. Strangely water_treatment_tag category does not share any common bigrams with pollution_control_tag, which means most of the pollution control documents might not be dealing with water, rather they deal woth air pollution. fight_against_unemployment_tag catgory as expected is sitting alone and dos not share any common terms with other catgories in the plot.</p>
</div>
<div id="word-association" class="section level5">
<h5><span class="header">Word association </span></h5>
<p>Another way to view word connections is to treat them as a network, similar to a social network. Word networks show term association and cohesion. Though these visuals can become very dense and hard to interpret visually.In a network graph, the circles are called nodes and represent individual terms, while the lines connecting the circles are called edges and represent the connections between the terms. As considering entire corpus would not make sense, considering only categories related to water and employment and plot them separately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> (bigram_graph &lt;-<span class="st"> </span>bigram_tokens <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">separate</span>(bigram, <span class="kw">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">filter</span>(<span class="op">!</span>word1 <span class="op">%in%</span><span class="st"> </span>law_stopwrds,
               <span class="op">!</span>word2 <span class="op">%in%</span><span class="st"> </span>law_stopwrds) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&#39;water&#39;</span>, label)) <span class="op">%&gt;%</span>
<span class="st">        </span>dplyr<span class="op">::</span><span class="kw">count</span>(word1, word2, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">unite</span>(<span class="st">&quot;bigram&quot;</span>, <span class="kw">c</span>(word1, word2), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">top_n</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">graph_from_data_frame</span>()
)

a &lt;-<span class="st"> </span>grid<span class="op">::</span><span class="kw">arrow</span>(<span class="dt">type =</span> <span class="st">&quot;closed&quot;</span>, <span class="dt">length =</span> <span class="kw">unit</span>(.<span class="dv">15</span>, <span class="st">&quot;inches&quot;</span>))

<span class="kw">ggraph</span>(bigram_graph, <span class="dt">layout =</span> <span class="st">&quot;fr&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_edge_link</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_node_point</span>(<span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_node_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">repel=</span><span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_void</span>() </code></pre></div>
<div class="figure">
<img src="Figs/water_wa.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> (bigram_graph &lt;-<span class="st"> </span>bigram_tokens <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">separate</span>(bigram, <span class="kw">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">filter</span>(<span class="op">!</span>word1 <span class="op">%in%</span><span class="st"> </span>law_stopwrds,
               <span class="op">!</span>word2 <span class="op">%in%</span><span class="st"> </span>law_stopwrds) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&#39;water&#39;</span>, label)) <span class="op">%&gt;%</span>
<span class="st">        </span>dplyr<span class="op">::</span><span class="kw">count</span>(word1, word2, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">unite</span>(<span class="st">&quot;bigram&quot;</span>, <span class="kw">c</span>(word1, word2), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">top_n</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">graph_from_data_frame</span>()
)

a &lt;-<span class="st"> </span>grid<span class="op">::</span><span class="kw">arrow</span>(<span class="dt">type =</span> <span class="st">&quot;closed&quot;</span>, <span class="dt">length =</span> <span class="kw">unit</span>(.<span class="dv">15</span>, <span class="st">&quot;inches&quot;</span>))

<span class="kw">ggraph</span>(bigram_graph, <span class="dt">layout =</span> <span class="st">&quot;fr&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_edge_link</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_node_point</span>(<span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_node_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">repel=</span><span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_void</span>() </code></pre></div>
<div class="figure">
<embed src="Figs/employment_wa.png%22" />

</div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
